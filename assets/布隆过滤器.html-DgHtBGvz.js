import{_ as i,r as a,o as p,c,b as s,e as n,d as e,w as r,a as l}from"./app-oJgUVX7T.js";const d="/assets/image-20230910172213726-CoLGoPiL.png",u={},m=s("h1",{id:"布隆过滤器",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#布隆过滤器"},[s("span",null,"布隆过滤器")])],-1),b=s("li",null,[n("大数据量去重 "),s("ul",null,[s("li",null,"黑名单过滤"),s("li",null,"文章推荐")])],-1),k=l('<h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h2><p>布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。</p><ul><li>数据存在时，这个数据可能不存在 <ul><li>哈希函数会出现碰撞，所以布隆过滤器会存在误判</li></ul></li><li>数据不存在时，那么这个数据一定不存在</li><li>可以插入元素，但不可以删除已有元素 <ul><li>删除意味着需要将对应的 k 个 bits 位置设置为 0，其中有可能是其他元素对应的位。</li></ul></li><li>元素越多，false positive rate(误报率)越大，但是 false negative (漏报)是不可能的</li></ul><p><img src="'+d+`" alt="image-20230910172213726"></p><h2 id="redis-集成布隆过滤器" tabindex="-1"><a class="header-anchor" href="#redis-集成布隆过滤器"><span>Redis 集成布隆过滤器</span></a></h2><h3 id="mac-安装" tabindex="-1"><a class="header-anchor" href="#mac-安装"><span>Mac 安装</span></a></h3><p>mac 下需要安装Xcode Command Line Tools：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>xcode-select <span class="token parameter variable">--install</span>
xcode-select <span class="token parameter variable">--version</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redisbloom" tabindex="-1"><a class="header-anchor" href="#redisbloom"><span>RedisBloom</span></a></h3>`,9),v={href:"https://github.com/RedisBloom/RedisBloom/releases",target:"_blank",rel:"noopener noreferrer"},h=l(`<p>编译：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>➜  RedisBloom-2.2.14 <span class="token function">make</span>
ld /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/rebloom.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/contrib/MurmurHash2.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/rmutil/util.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/sb.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/cf.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/rm_topk.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/topk.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/rm_cms.o /Users/lizhifu/Downloads/RedisBloom-2.2.14/src/cms.o <span class="token parameter variable">-o</span> /Users/lizhifu/Downloads/RedisBloom-2.2.14/redisbloom.so <span class="token parameter variable">-syslibroot</span> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk <span class="token parameter variable">-dylib</span> <span class="token parameter variable">-exported_symbol</span> _RedisModule_OnLoad <span class="token parameter variable">-lm</span> <span class="token parameter variable">-lc</span>
➜  RedisBloom-2.2.14
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 redis.conf 文件，新增 <code>loadmodule</code>配置</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment">################################## MODULES #####################################</span>

<span class="token comment"># Load modules at startup. If the server is not able to load modules</span>
<span class="token comment"># it will abort. It is possible to use multiple loadmodule directives.</span>
<span class="token comment">#</span>
<span class="token comment"># loadmodule /path/to/my_module.so</span>
<span class="token comment"># loadmodule /path/to/other_module.so</span>
<span class="token comment"># 如果是集群，则每个实例的配置文件都需要加入配置。</span>
<span class="token key attr-name">loadmodule</span> <span class="token value attr-value">/Users/lizhifu/Downloads/RedisBloom-2.2.14/redisbloom.so</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>redis-server /usr/local/etc/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动成功：Module &#39;bf&#39; loaded from /Users/lizhifu/Downloads/RedisBloom-2.2.14/redisbloom.so</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 <span class="token comment"># Server initialized</span>
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * Module <span class="token string">&#39;bf&#39;</span> loaded from /Users/lizhifu/Downloads/RedisBloom-2.2.14/redisbloom.so
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * Loading RDB produced by version <span class="token number">6.2</span>.6
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * RDB age <span class="token number">3</span> seconds
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * RDB memory usage when created <span class="token number">1.04</span> Mb
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 <span class="token comment"># Done loading RDB, keys loaded: 0, keys expired: 0.</span>
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * DB loaded from disk: <span class="token number">0.000</span> seconds
<span class="token number">28582</span>:M <span class="token number">13</span> Apr <span class="token number">2022</span> <span class="token number">13</span>:20:05.083 * Ready to accept connections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="客户端使用" tabindex="-1"><a class="header-anchor" href="#客户端使用"><span>客户端使用</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>BF.ADD --添加一个元素到布隆过滤器
BF.EXISTS --判断元素是否在布隆过滤器
BF.MADD --添加多个元素到布隆过滤器
BF.MEXISTS --判断多个元素是否在布隆过滤器
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bf.add user keben
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>  bf.add user zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bf.add user zhaosi
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bf.exists user keben
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bf.madd user xiaoming zhangwu wanger
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bf.mexists user xiaoming zhangwu wanger
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis客户端" tabindex="-1"><a class="header-anchor" href="#redis客户端"><span>Redis客户端</span></a></h2><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BloomFilterService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 创建布隆过滤器
     * <span class="token keyword">@param</span> <span class="token parameter">filterName</span> 布隆过滤器名称
     * <span class="token keyword">@param</span> <span class="token parameter">expectedInsertions</span> 布隆过滤器期望插入数量
     * <span class="token keyword">@param</span> <span class="token parameter">falseProbability</span> 布隆过滤器期望误判率
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span> 布隆过滤器
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> filterName<span class="token punctuation">,</span> <span class="token keyword">long</span> expectedInsertions<span class="token punctuation">,</span> <span class="token keyword">double</span> falseProbability<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 集群环境下，可以使用下面的方式创建布隆过滤器</span>
        <span class="token comment">// RClusteredBloomFilter&lt;SomeObject&gt; bloomFilter = redisson.getClusteredBloomFilter(&quot;filterName&quot;);</span>
        <span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span>filterName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 初始化布隆过滤器</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span>expectedInsertions<span class="token punctuation">,</span> falseProbability<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bloomFilter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13);function g(f,B){const t=a("RouteLink"),o=a("ExternalLinkIcon");return p(),c("div",null,[m,s("ul",null,[b,s("li",null,[n("解决"),e(t,{to:"/database/nosql/%E5%87%BB%E7%A9%BF%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9.html"},{default:r(()=>[n("缓存穿透")]),_:1}),n("问题")])]),k,s("p",null,[n("下载："),s("a",v,[n("Releases · RedisBloom/RedisBloom (github.com)"),e(o)])]),h])}const R=i(u,[["render",g],["__file","布隆过滤器.html.vue"]]),w=JSON.parse('{"path":"/database/nosql/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8.html","title":"布隆过滤器","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"概念","slug":"概念","link":"#概念","children":[]},{"level":2,"title":"Redis 集成布隆过滤器","slug":"redis-集成布隆过滤器","link":"#redis-集成布隆过滤器","children":[{"level":3,"title":"Mac 安装","slug":"mac-安装","link":"#mac-安装","children":[]},{"level":3,"title":"RedisBloom","slug":"redisbloom","link":"#redisbloom","children":[]}]},{"level":2,"title":"客户端使用","slug":"客户端使用","link":"#客户端使用","children":[]},{"level":2,"title":"Redis客户端","slug":"redis客户端","link":"#redis客户端","children":[]}],"git":{"updatedTime":1694337805000,"contributors":[{"name":"拔土豆的程序员","email":"lizhifuabc@163.com","commits":1}]},"filePathRelative":"database/nosql/布隆过滤器.md"}');export{R as comp,w as data};
